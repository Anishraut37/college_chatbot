<!DOCTYPE html>
<html>
<head>
    <title>AI Chat Assistant</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            margin: 0;
            padding: 0;
            background: #dbe4ff;
            font-family: "Poppins", sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chat-container {
            width: 95%;
            max-width: 450px;
            height: 90vh;
            background: white;
            border-radius: 16px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            height: 60px;
            background: #4263eb;
            color: white;
            border-radius: 16px 16px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
        }

        .header-buttons button {
            background: #364fc7;
            border: none;
            padding: 8px 14px;
            border-radius: 8px;
            color: white;
            margin-left: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .user-msg, .bot-msg {
            max-width: 80%;
            padding: 12px;
            border-radius: 12px;
            margin-top: 10px;
            display: inline-block;
            clear: both;
            word-wrap: break-word;
        }

        .user-msg { background: #4dabf7; color: white; float: right; }
        .bot-msg { background: #e9ecef; float: left; }

        .input-box {
            display: flex;
            padding: 12px;
            border-top: 1px solid #ccc;
            gap: 8px;
        }

        input {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid #aaa;
            outline: none;
        }

        #micBtn {
            width: 50px;
            border-radius: 12px;
            border: none;
            font-size: 20px;
            cursor: pointer;
            background: #4dabf7;
            color: white;
        }

        #micBtn.listening {
            background: red;
            animation: pulse 1s infinite;
        }

        .send-btn {
            padding: 12px 18px;
            background: #4263eb;
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .send-btn:hover {
            background: #364fc7;
            transform: scale(1.05);
        }


        @keyframes pulse {
            50% { transform: scale(1.2); }
        }


    </style>
</head>
<body>

<div class="chat-container">
    <div class="chat-header">
        <h3 style="font-size:16px;">AI Chat Assistant</h3>

        <div class="header-buttons">
            <button onclick="window.location.href='/history/'">History</button>
            <button onclick="window.location.href='/logout/'">Logout</button>
        </div>
    </div>

    <div class="messages" id="messages"></div>

    <div class="input-box">
        <button id="micBtn">üé§</button>
        <input id="question" placeholder="Speak or type...">
        <button class="send-btn" onclick="sendMessage()">Send</button>

    </div>
</div>

<script>
function sendMessage() {
    let q = document.getElementById("question").value;
    if (q.trim() === "") return;

    let msgBox = document.getElementById("messages");
    msgBox.innerHTML += `<div class='user-msg'>${q}</div>`;
    document.getElementById("question").value = "";

    fetch("/ask/", {
        method: "POST",
        headers: { "Content-Type": "application/json", "X-CSRFToken": "{{ csrf_token }}" },
        body: JSON.stringify({ question: q })
    })
    .then(response => response.json())
    .then(data => {
        msgBox.innerHTML += `<div class='bot-msg'>${data.answer}</div>`;
        msgBox.scrollTop = msgBox.scrollHeight;
    });
}

document.getElementById("micBtn").addEventListener("click", function () {
    if (!('webkitSpeechRecognition' in window)) {
        alert("Voice recognition works only in Chrome browser.");
        return;
    }

    const recognition = new webkitSpeechRecognition();
    recognition.lang = "en-IN";
    recognition.interimResults = false;

    let mic = document.getElementById("micBtn");
    mic.classList.add("listening");
    mic.innerText = "üéôÔ∏è";
    recognition.start();

    recognition.onresult = function (event) {
        document.getElementById("question").value = event.results[0][0].transcript;
        mic.classList.remove("listening");
        mic.innerText = "üé§";
    };

    recognition.onerror = function () {
        mic.classList.remove("listening");
        mic.innerText = "üé§";
    };
});
</script>

</body>
</html>
